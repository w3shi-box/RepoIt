name: PR Target Python Side Effect

on:
  pull_request_target:
    types: [opened, synchronize]

permissions:
  contents: read

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout attacker PR code
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.pull_request.head.sha }}

      - name: Run kubernetes helper script
        run: |
          python kubernetes/scripts/generate_diff.py

      - name: Upload output
        uses: actions/upload-artifact@v4
        with:
          name: diff
          path: output/

  comment:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - name: Download artifact
        uses: actions/download-artifact@v4
        with:
          name: diff
          path: output/

      - name: Comment using secret (NO python here)
        env:
          YES_TOKEN: ${{ secrets.MY_TOKEN }}
        run: |
          echo "Posting diff"
          echo "$YES_TOKEN"
